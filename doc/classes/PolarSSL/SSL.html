<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>PolarSSL::SSL</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            PolarSSL::SSL 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/ext/polarssl/polarssl_c.html">ext/polarssl/polarssl.c</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>This class is the base for doing <a href="SSL.html">SSL</a> communication
over a socket.</p>

<h2 id="label-Sample">Sample</h2>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;polarssl&#39;</span>

<span class="ruby-identifier">socket</span> = <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;polarssl.org&#39;</span>, <span class="ruby-value">443</span>)

<span class="ruby-identifier">entropy</span> = <span class="ruby-constant">PolarSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Entropy</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">ctr_drbg</span> = <span class="ruby-constant">PolarSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">CtrDrbg</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">entropy</span>)
<span class="ruby-identifier">ssl</span> = <span class="ruby-constant">PolarSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span>.<span class="ruby-identifier">new</span>

<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">set_endpoint</span>(<span class="ruby-constant">PolarSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL_IS_CLIENT</span>)
<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">set_authmode</span>(<span class="ruby-constant">PolarSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL_VERIFY_NONE</span>)
<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">set_rng</span>(<span class="ruby-identifier">ctr_drbg</span>)

<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">set_socket</span>(<span class="ruby-identifier">socket</span>)

<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">handshake</span>

<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;GET / HTTP/1.0\r\nHost: polarssl.org\r\n\r\n&quot;</span>)

<span class="ruby-keyword">while</span> <span class="ruby-identifier">chunk</span> = <span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">1024</span>)
    <span class="ruby-identifier">response</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">chunk</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>

<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">close_notify</span>

<span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>

<span class="ruby-identifier">ssl</span>.<span class="ruby-identifier">close</span>
</pre>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="SSL/Error.html">PolarSSL::SSL::Error</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-close">close</a>,
              </li>
            
              
              <li>
                <a href="#method-i-close_notify">close_notify</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-handshake">handshake</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-read">read</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-set_authmode">set_authmode</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_endpoint">set_endpoint</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_rng">set_rng</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_socket">set_socket</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>W</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-write">write</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">SSL_IS_CLIENT</td>
            <td>=</td>
            <td class="attr-value">0</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Endpoint mode for acting as a client.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SSL_VERIFY_NONE</td>
            <td>=</td>
            <td class="attr-value">0</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Certificate verification mode for doing no verification.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SSL_VERIFY_OPTIONAL</td>
            <td>=</td>
            <td class="attr-value">1</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Certificate verification mode for optional verification.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SSL_VERIFY_REQUIRED</td>
            <td>=</td>
            <td class="attr-value">2</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Certificate verification mode for having required verification.</p></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
        
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-close">
            
              <b>close() &rarr; true
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-close" name="method-i-close" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Final method to be called when done using the <a href="SSL.html">SSL</a>
connection. This immediately frees any <a href="SSL.html">SSL</a> data in
the memory instead of waiting for the Ruby garbage collector.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-close_source')" id="l_method-i-close_source">show</a>
                
              </p>
              <div id="method-i-close_source" class="dyn-source">
                <pre>static VALUE R_close( VALUE self )
{
    ssl_context *ssl;
    Data_Get_Struct( self, ssl_context, ssl );

    memset( ssl, 0, sizeof( ssl_context ) );

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-close_notify">
            
              <b>close_notify() &rarr; true or raises
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-close_notify" name="method-i-close_notify" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Notifies the peer to close the connection. true or raises <a
href="SSL/Error.html">PolarSSL::SSL::Error</a></p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-close_notify_source')" id="l_method-i-close_notify_source">show</a>
                
              </p>
              <div id="method-i-close_notify_source" class="dyn-source">
                <pre>static VALUE R_ssl_close_notify( VALUE self )
{
    ssl_context *ssl;
    int ret;
    Data_Get_Struct( self, ssl_context, ssl );

    ret = ssl_close_notify( ssl );

    if (ret &lt; 0)
        rb_raise( e_SSLError, &quot;-0x%x&quot;, -ret );

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-handshake">
            
              <b>handshake() &rarr; true or exception
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-handshake" name="method-i-handshake" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Initiates <a href="SSL.html">SSL</a> handshake. When something goes wrong,
raises one of:</p>
<ul><li>
<p><a href="NetWantRead.html">PolarSSL::NetWantRead</a>,</p>
</li><li>
<p><a href="NetWantWrite.html">PolarSSL::NetWantWrite</a> or</p>
</li><li>
<p><a href="SSL/Error.html">PolarSSL::SSL::Error</a></p>
</li></ul>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-handshake_source')" id="l_method-i-handshake_source">show</a>
                
              </p>
              <div id="method-i-handshake_source" class="dyn-source">
                <pre>static VALUE R_ssl_handshake(VALUE self)
{
    ssl_context *ssl;
    int ret;

    Data_Get_Struct( self, ssl_context, ssl );

    ret = ssl_handshake( ssl );

    if ( ret &lt; 0 )
    {
        if ( ret == POLARSSL_ERR_NET_WANT_READ )
        {
          rb_raise( e_NetWantRead, &quot;ssl_handshake() returned POLARSSL_ERR_NET_WANT_READ&quot; );
        }
        else if ( ret == POLARSSL_ERR_NET_WANT_WRITE )
        {
          rb_raise( e_NetWantWrite, &quot;ssl_handshake() returned POLARSSL_ERR_NET_WANT_WRITE&quot; );
        }
        else
        {
          rb_raise( e_SSLError, &quot;-0x%x&quot;, -ret );
        }
    }
    else
    {
        return Qtrue;
    }
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-read">
            
              <b>read( length ) &rarr; string or raises
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-read" name="method-i-read" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Reads <code>length</code> bytes from the <a href="SSL.html">SSL</a>
connection or raises <a href="SSL/Error.html">PolarSSL::SSL::Error</a>.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-read_source')" id="l_method-i-read_source">show</a>
                
              </p>
              <div id="method-i-read_source" class="dyn-source">
                <pre>static VALUE R_ssl_read( VALUE self, VALUE length )
{
    ssl_context *ssl;
    VALUE result;
    int buffer_size = NUM2INT( length );
    unsigned char buffer[buffer_size];
    int length_to_read;
    int length_read;

    Check_Type( length, T_FIXNUM );

    Data_Get_Struct( self, ssl_context, ssl );

    length_to_read = sizeof( buffer ) - 1;
    length_read = ssl_read( ssl, buffer, length_to_read );

    if ( length_read == 0 || length_read == POLARSSL_ERR_SSL_PEER_CLOSE_NOTIFY )
    {
        result = Qnil;
    }
    else if (length_read &lt; 0)
    {
        rb_raise( e_SSLError, &quot;-0x%x&quot;, -length_read );
    }
    else
    {
        result = rb_str_new2( (char *)buffer );
    }

    return result;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_authmode">
            
              <b>set_authmode( authentication_mode )
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-set_authmode" name="method-i-set_authmode" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Sets the certificate verification mode for the <a href="SSL.html">SSL</a>
connection. Possible values are:</p>
<ul><li>
<p>PolarSSL::SSL::SSL_VERIFY_NONE</p>
</li><li>
<p>PolarSSL::SSL::SSL_VERIFY_OPTIONAL</p>
</li><li>
<p>PolarSSL::SSL::SSL_VERIFY_REQUIRED</p>
</li></ul>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-set_authmode_source')" id="l_method-i-set_authmode_source">show</a>
                
              </p>
              <div id="method-i-set_authmode_source" class="dyn-source">
                <pre>static VALUE R_ssl_set_authmode( VALUE self, VALUE authmode )
{
    ssl_context *ssl;

    Check_Type( authmode, T_FIXNUM );

    Data_Get_Struct( self, ssl_context, ssl );

    ssl_set_authmode( ssl, NUM2INT( authmode ) );

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_endpoint">
            
              <b>set_endpoint( endpoint_mode )
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-set_endpoint" name="method-i-set_endpoint" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Sets the endpoint mode for the current <a href="SSL.html">SSL</a>
connection to act as a server or a client. Possible values are:</p>
<ul><li>
<p>PolarSSL::SSL::SSL_IS_CLIENT</p>
</li></ul>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-set_endpoint_source')" id="l_method-i-set_endpoint_source">show</a>
                
              </p>
              <div id="method-i-set_endpoint_source" class="dyn-source">
                <pre>static VALUE R_ssl_set_endpoint( VALUE self, VALUE endpoint_mode )
{
    ssl_context *ssl;

    Check_Type( endpoint_mode, T_FIXNUM );

    Data_Get_Struct( self, ssl_context, ssl );

    ssl_set_endpoint( ssl, NUM2INT( endpoint_mode ) );

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_rng">
            
              <b>set_rng( random_number_generator )
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-set_rng" name="method-i-set_rng" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Sets the random number generator to be used for this connection. You need
to use an instance of PolarSSL::CtrDrbg for this. Example:</p>

<pre>entropy = PolarSSL::Entropy.new
ctr_drbg = PolarSSL::CtrDrbg.new(entropy)

ssl = PolarSSL::SSL.new
ssl.set_rng(ctr_drbg)

# other ssl connection settings and usage</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-set_rng_source')" id="l_method-i-set_rng_source">show</a>
                
              </p>
              <div id="method-i-set_rng_source" class="dyn-source">
                <pre>static VALUE R_ssl_set_rng( VALUE self, VALUE rng )
{
    ssl_context *ssl;
    ctr_drbg_context *ctr_drbg;

    Check_Type( rng, T_DATA );

    Data_Get_Struct( self, ssl_context, ssl );
    Data_Get_Struct( rng, ctr_drbg_context, ctr_drbg );

    ssl_set_rng( ssl, ctr_drbg_random, ctr_drbg );

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_socket">
            
              <b>set_socket( socket )
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-set_socket" name="method-i-set_socket" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Set the TCPSocket to be used for this <a href="SSL.html">SSL</a>
connection. Example:</p>

<pre>socket = TCPSocket.new(&#39;polarssl.org&#39;, 443)

ssl = PolarSSL::SSL.new
ssl.set_socket(socket)</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-set_socket_source')" id="l_method-i-set_socket_source">show</a>
                
              </p>
              <div id="method-i-set_socket_source" class="dyn-source">
                <pre>static VALUE R_ssl_set_socket( VALUE self, VALUE socket )
{
    ssl_context *ssl;
    rb_io_t *fptr;

    Check_Type( socket, T_FILE );

    Data_Get_Struct( self, ssl_context, ssl );

    GetOpenFile( socket, fptr );

    ssl_set_bio( ssl, net_recv, &amp;fptr-&gt;fd, net_send, &amp;fptr-&gt;fd );

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-write">
            
              <b>write( string ) &rarr; true or raises
</b>
            
            <a href="../../classes/PolarSSL/SSL.html#method-i-write" name="method-i-write" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Writes to the <a href="SSL.html">SSL</a> connection or raises <a
href="SSL/Error.html">PolarSSL::SSL::Error</a>.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-write_source')" id="l_method-i-write_source">show</a>
                
              </p>
              <div id="method-i-write_source" class="dyn-source">
                <pre>static VALUE R_ssl_write( VALUE self, VALUE string )
{
    ssl_context *ssl;
    char *buffer;
    int ret;

    Check_Type( string, T_STRING );

    Data_Get_Struct( self, ssl_context, ssl );

    buffer = RSTRING_PTR( string );

    ret = ssl_write( ssl, (const unsigned char *) buffer, RSTRING_LEN( string ) );

    if ( ret &lt; 0 )
        rb_raise( e_SSLError, &quot;-0x%x&quot;, -ret );

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    